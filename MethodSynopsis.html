<!DOCTYPE html>
<html lang="en">
<h1>ICAO ATS and OLDI Parser Method Synopsis</h1>
<p>This section contains descriptions for a number of methods that can be used to retrieve data for a
    parsed message. The parser only has to be instantiated once. The input string and flight plan output class
    must be provided as new instances of:
</p>
<ul>
    <li>An input string representing a message to parse;</li>
    <li>An instance of the FlightPlanRecord class that will contain all the fields and any associated errors
    extracted from a parsed message;</li>
</ul>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>


<h2>Parsing a Message</h2>
    <p>Two methods are provided to parse a message, one method returns an instance of a flight plan record,
        the other takes an instance of a flight plan record as an input parameter; both methods require a string
        representing the message to parse.
    </p>
    <p>A string representing a message to parse must be instantiated first, the following provides an
    example ATS FPL messages that can be used to evaluate the parser:
    </p>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code>icao_message: str = "(FPL-TEST01
                     -IS-B737/M
                     -S/C-LOWW0800
                     -N0450f350 PNT B9 LNZ1A
                     -EGLL0200
                     -RMK/THIS IS A REMARK)"
            </code></pre>
        </td></tr>
    </table>

    <h3>Message Parser - Method 1</h3>
    <p>The following parser method returns an instance of a flight plan record:</p>
    <p>Method Parameters:
        <ul>
            <li>String: A string representing the message to parse;</li>
            <li>Return: An instance of FlightPlanRecord containing the fields extracted from the parsed message;</li>
        </ul>
    </p>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code># Instantiate the parser...</code></pre>
            <pre><code>icao_message_parser: IcaoAtsMessageParser = IcaoAtsMessageParser()</code></pre>
        </td></tr>
        <tr><td>
            <pre><code># Parse the message...</code></pre>
            <pre><code>flight_plan_record: FlightPlanRecord = icao_message_parser.parse_message_p1(icao_message)</code></pre>
        </td></tr>
    </table>
    <h3>Message Parser - Method 2</h3>
    <p>The following parser method takes both an instance of a flight plan record and a string
        representing a message to parse:</p>
    <p>Method Parameters:
        <ul>
            <li>String: A string representing the message to parse;</li>
            <li>FlightPlanRecord: An instance of FlightPlanRecord that will contain the fields extracted from the
                parsed message;</li>
            <li>Return: True if errors were detected, False if no errors were detected;</li>
        </ul>
    </p>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code># Instantiate a FlightPlanRecord, the output is written into this class instance.</code></pre>
            <pre><code>flight_plan_record: FlightPlanRecord = FlightPlanRecord() </code></pre>
        </td></tr>
        <tr><td>
            <pre><code># Instantiate the parser...</code></pre>
            <pre><code>icao_message_parser = IcaoAtsMessageParser() </code></pre>
        </td></tr>
        <tr><td>
            <pre><code># Parse the message...</code></pre>
            <pre><code>result = icao_message_parser.parse_message_p2(flight_plan_record, icao_message) </code></pre>
        </td></tr>
    </table>
<h2>Retrieving Data for a Parsed Message</h2>
    <p>This section describes methods to recover data from a parsed message. The first section describes
        how to ascertain if errors were detected and how to retrieve the errors.
        The second part describes how to retrieve message field data.
    </p>
<h3>Error Detection</h3>
    <p>There exist two sources of errors:
    </p>
    <ul>
        <li>Errors generated by parsing any ICAO field other than ICAO field 15;</li>
        <li>Errors generated as a result of performing route extraction on ICAO Field 15;</li>
    </ul>
    <p>The errors for case 1 above are stored directly in a FlightPlanRecord instance as a list of one or more
    ErrorRecord instances. The field 15 errors are stored in an ExtractedRouteSequence instance which
    is stored in the FlightPlanRecord instance; hence for the field 15 route extraction errors,
    the errors have to be retrieved through the ExtractedRouteSequence class.</p>

    <h4>Errors for all Fields except Field 15</h4>
    <p>The following describes how to recover errors related to any field other than field 15.</p>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code># First, parse the message...</code></pre>
            <pre><code>result = icao_message_parser.parse_message_p2(flight_plan_record, icao_message) </code></pre>
        </td></tr>
        <tr><td>
            <pre><code># If errors were detected, result will be False; to get the error records do the following...</code></pre>
            <pre><code>if not result:</code></pre>
            <pre><code>    # For fields other than field 15 call the following method, this returns a list of ErrorRecord's...</code></pre>
            <pre><code>    basic_field_errors: [ErrorRecord] = flight_plan_record.get_erroneous_fields() </code></pre>
        </td></tr>
    </table>
    <p>The ErrorRecord class contains the following methods to recover the field text, errors and zero based
    indices of a fields position in the original message:
    </p>
    <ul>
        <li>ErrorRecord.get_field_text(): Recovers the text representing the field in error;</li>
        <li>ErrorRecord.get_start_index(): The zero based index to the first character of the field in the original message;</li>
        <li>ErrorRecord.get_end_index(): The zero based index to the last character + 1 of the field in the original message;</li>
        <li>ErrorRecord.get_error_message(): The error message reported by the parser for this field;</li>
    </ul>

    <h4>Errors for Field 15</h4>
    <p>The following describes how to recover route extraction errors generated by parsing field 15.</p>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code># For field 15, get the Extracted Route Sequence and get the errors, returns a list of Tokens...</code></pre>
            <pre><code>if flight_plan_record.get_extracted_route_sequence().get_number_of_errors() > 0:</code></pre>
            <pre><code>    field_15_errors: [ExtractedRouteRecord] = flight_plan_record.get_f15_errors() </code></pre>
        </td></tr>
    </table>

    <p>The ExtractedRouteRecord class contains the following methods to recover the field text, errors and zero based
    indices of a fields position in the original message:
    </p>
    <ul>
        <li>ExtractedRouteRecord.get_name(): Recovers the text representing the field in error within field 15;</li>
        <li>ExtractedRouteRecord.get_start_index(): The zero based index to the first character of the field in the original message;</li>
        <li>ExtractedRouteRecord.get_end_index(): The zero based index to the last character + 1 of the field in the original message;</li>
        <li>ExtractedRouteRecord.get_error_text(): The error message reported by the parser for this field;</li>
    </ul>
    <p>The ExtractedRouteRecord class contains numerous other methods to retrieve further information about an
        extracted route item. These methods are covered in the section dealing with data recovery from the extracted
        route record in general. The above example deals with retrieving error information. The start and end
        indices can be used to highlight an erroneous field in a GUI.
    </p>

    <h2>Data Retrieval for all Fields except Field 15</h2>
    <p>This section describes how to retrieve data for individual fields. All field access and their associated
        subfields requires the use of the enumeration values from the Configuration.EnumerationConstants.FieldIdentifiers
        and Configuration.EnumerationConstants.SubFieldIdentifiers enumeration classes; a number of these
        enumeration values will be used in the following examples.
    </p>
    <p>The following example shows how to retrieve ICAO Field 13; (e.g. LOWW0800). for other fields, use the
    relevant field identifier from those available in the FieldIdentifiers enumeration class.
    </p>
    <p>If the field is unavailable, 'None' is returned.
    </p>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code># Get the complete ICAO Field 13</code></pre>
            <pre><code>f13: str = flight_plan_record.get_icao_field(FieldIdentifiers.F13).get_field_text()</code></pre>
        </td></tr>
    </table>
    <p>The following example shows how to retrieve a subfield from ICAO Field 16, subfield 'b', (e.g. if F16
        contained 'EGLL0200 EGMM') then '0200' would be returned. For other field/subfields, use the
        relevant field and subfield identifiers from those available in the FieldIdentifiers and
        SubFieldIdentifiers enumeration classes.
    </p>
    <p>If the subfield is unavailable, 'None' is returned.
    </p>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code># Get the ICAO field 16 EET (Field 16 'b')</code></pre>
            <pre><code>f16b: str = flight_plan_record.get_icao_subfield(</code></pre>
            <pre><code>    FieldIdentifiers.F16, SubFieldIdentifiers.F16b).get_field_text() </code></pre>
        </td></tr>
    </table>

    <h3>Flight Plan Record Get Methods</h3>
    <p>There are numerous 'getter' methods included in the FlightPlanRecord class; these are described below:
    </p>
    <ul>
        <li><b>as_xml()</b>: Returns an XML representation of the parsed message; returns a string as a valid
            XML document;</li>
        <li><b>get_all_icao_subfields(FieldIdentifiers, SubFieldIdentifiers)</b>: A number of Field 18 keyword/data items
            can occur more than once; this method is provided to retrieve 'n' subfields from an ICAO field.
            The method takes the field and subfield identifiers as parameters and returns a list of SubFieldRecord
            records. If the field or subfield(s) do not exist, None is returned.
        </li>
        <li><b>get_derived_flight_rules()</b>: Returns the flight rules derived by parsing field 15, (this is NOT
            field 8a). When performing route extraction, the parser determines the flight rules from the route. This
            is used in consistency checking field 15 with field 8a (which should be the same). Returns an
            enumeration value from the FlightRules class.
        </li>
        <li><b>get_erroneous_fields()</b>: Returns a list of ErrorRecord instances that store all erroneous fields
            found during parsing.
        </li>
        <li><b>get_extracted_route()</b>: Returns and instance of the ExtractedRouteSequence class containing
            the extracted route sequenced derived by the field 15 parser.
        </li>
        <li><b>get_f15_errors()</b>: Returns a list of ExtractedRouteRecord class instances for erroneous field
            15 items.
        </li>
        <li><b>get_f22_flight_plan()</b>: Return an instance of FlightPlanRecord that contains all the fields
            extracted and parsed by the field 22 parser.
        </li>
        <li><b>get_icao_field(FieldIdentifiers)</b>: Returns an instance of a FieldRecord class containing the
            field specified by the FieldIdentifiers enumeration value, or None if the field does not
            exist.
        </li>
        <li><b>get_icao_subfield(FieldIdentifiers, SubFieldIdentifiers)</b>: Returns an instance of a SubFieldRecord
            class containing the subfield specified by the FieldIdentifiers and ubFieldIdentifiers enumeration
            values, or None if the subfield does not exist.
        </li>
        <li><b>get_message_body()</b>: Returns the message body as submitted for parsing, the message body
            excludes the message header; this starts at the open bracket for ICAO format messages.
        </li>
        <li><b>get_message_complete()</b>: Returns the complete message, that is the message header and body
            as submitted for parsing.
        </li>
        <li><b>get_message_header()</b>: Returns the message header as submitted for parsing, the message header
            excludes the message body; this starts at the beginning of a message up to the character preceding the
            open bracket for ICAO format messages.
        </li>
        <li><b>get_message_title()</b>: Returns the message title as an enumeration value from the
            MessageTitles class. If the title is unrecognised by the parser MessageTitles->UNKNOWN is returned.
        </li>
        <li><b>get_message_type()</b>: Returns the message type (ICAO ATS, OLDI, ADEXP or UNKNOWN) as an
            enumeration value from the MessageTypes class.</li>
        <li><b>get_receiver_adjacent_unit_name(self)</b>: Returns the name of the receiver adjacent unit name
            extracted from Field 3b as an enumeration value from the AdjacentUnits class.
        </li>
        <li><b>get_sender_adjacent_unit_name(self)</b>: Returns the name of the sending adjacent unit name
            extracted from Field 3b as an enumeration value from the AdjacentUnits class.
        </li>
    </ul>
    <p></p>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code></code></pre>
            <pre><code></code></pre>
        </td></tr>
    </table>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code></code></pre>
            <pre><code></code></pre>
        </td></tr>
    </table>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code></code></pre>
            <pre><code></code></pre>
        </td></tr>
    </table>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code></code></pre>
            <pre><code></code></pre>
        </td></tr>
    </table>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code></code></pre>
            <pre><code></code></pre>
        </td></tr>
    </table>
    <table>
        <colgroup>
            <col span="1" style="background-color:lightgrey">
        </colgroup>
        <tr><td>
            <pre><code></code></pre>
            <pre><code></code></pre>
        </td></tr>
    </table>



<p></p>
<p></p>
<p></p>

</html>